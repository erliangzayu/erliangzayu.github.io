<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¦ LionfishåŸ Â· OCå®æ—¶è¡Œè¸ª</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        body { background: #0f1623; color: #e6edf3; padding: 20px; min-height: 100vh; overflow-x: hidden; }
        
        /* é¡¶éƒ¨æ—¶é—´+è·¯å¾„+æç¤º */
        .header { text-align: center; margin-bottom: 24px; }
        .title { font-size: 24px; font-weight: 600; color: #d7e4ff; margin-bottom: 8px; }
        .real-clock { display: inline-block; background: #1b263b; padding: 8px 16px; border-radius: 30px; color: #a9b8d4; font-size: 15px; }
        .area-path { margin-top: 8px; font-size: 14px; color: #8a9bb8; }
        .area-path.random { color: #ff6b8b; font-weight: 600; }
        .tip-bar { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #ff6b8b; color: #fff; padding: 8px 16px; border-radius: 20px; font-size: 14px; z-index: 999; opacity: 0; transition: opacity 0.3s ease; }
        .tip-bar.show { opacity: 1; }
        
        /* å¤§åŒºæŠ½å±‰å®¹å™¨ */
        .area-drawer-wrap { margin-bottom: 20px; }
        .big-area-drawer { margin-bottom: 8px; }
        .big-area-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; background: #172135; border-radius: 12px; cursor: pointer; border: 2px solid #253450; }
        .big-area-name { font-size: 16px; font-weight: 600; color: #c2d0e7; }
        .drawer-icon { color: #8a9bb8; transition: transform 0.3s ease; }
        .drawer-icon.active { transform: rotate(180deg); }
        
        /* å°åœ°ç‚¹ç½‘æ ¼ï¼ˆæŠ½å±‰å†…å®¹ï¼‰ */
        .small-area-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 12px 16px; background: #1b263b; border-radius: 0 0 12px 12px; margin-top: -2px; border: 2px solid #253450; border-top: none; display: none; }
        .small-area-grid.show { display: grid; }
        @media (max-width: 768px) { .small-area-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 480px) { .small-area-grid { grid-template-columns: 1fr; } }
        
        .small-area-card { padding: 10px 6px; border-radius: 8px; cursor: pointer; transition: 0.3s; text-align: center; color: #c2d0e7; background: #172135; border: 1px solid #253450; }
        .small-area-card.active { background: #4d82f9; color: #fff; border-color: #4d82f9; }
        .small-area-card.important { background: #2d3b55; border-color: #ff6b8b; color: #ff6b8b; }
        .small-area-card.important.active { background: #ff6b8b; color: #fff; border-color: #ff6b8b; }
        
        /* ä¸»ä½“å®¹å™¨ï¼šOCå¡ç‰‡ + ä¸»äººæ  */
        .main-container { display: flex; gap: 20px; margin-top: 20px; }
        .oc-container { flex: 1; }
        .owner-sidebar { width: 280px; background: #172135; border-radius: 18px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); flex-shrink: 0; display: none; }
        .owner-title { font-size: 16px; font-weight: 600; color: #edf2ff; margin-bottom: 12px; border-bottom: 1px solid #253450; padding-bottom: 8px; }
        .owner-card { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
        .owner-avatar { width: 40px; height: 40px; border-radius: 10px; object-fit: cover; }
        .owner-info { flex: 1; }
        .owner-name { font-size: 15px; font-weight: 600; color: #edf2ff; }
        .owner-status { font-size: 12px; color: #9cb8e7; }
        
        /* OCå¡ç‰‡ç½‘æ ¼ */
        .oc-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
        .oc-card { position: relative; background: #172135; border-radius: 18px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border-left: 4px solid #4d82f9; cursor: pointer; transition: 0.3s; }
        .oc-card.random { border-left-color: #ff6b8b; }
        .oc-card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(77,130,249,0.25); }
        .oc-random-tag { position: absolute; top: 10px; right: 10px; background: #ff6b8b; color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 6px; }
        .oc-avatar { width: 50px; height: 50px; border-radius: 12px; object-fit: cover; margin-right: 12px; }
        .oc-row { display: flex; align-items: center; }
        .oc-info { flex: 1; }
        .oc-name { font-size: 16px; font-weight: 600; color: #edf2ff; margin-bottom: 4px; }
        .oc-place { font-size: 12px; color: #9cb8e7; }
        .oc-action { font-size: 14px; color: #c2d0e7; margin-top: 6px; line-height: 1.4; }
        
        /* æ‚¬æµ®å¼¹çª— */
        .oc-popup { position: absolute; bottom: calc(100% + 10px); left: 50%; transform: translateX(-50%); width: 200px; background: #1e2a44; color: #e6edf3; padding: 12px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.4); font-size: 14px; line-height: 1.5; z-index: 10; opacity: 0; pointer-events: none; transition: 0.2s; }
        .oc-card:hover .oc-popup { opacity: 1; pointer-events: all; }
        .oc-popup a { color: #5f9fff; text-decoration: underline; }
        
        /* èŠå¤©æ°”æ³¡ */
        .chat-bubble-wrap { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 999; display: flex; flex-direction: column; gap: 8px; max-width: 80%; }
        .chat-bubble { background: #1e2a44; padding: 12px 16px; border-radius: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.4); display: flex; align-items: center; gap: 10px; animation: fadeInUp 0.3s ease; }
        .chat-avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; }
        .chat-content { flex: 1; }
        .chat-name { font-size: 12px; color: #9cb8e7; margin-bottom: 2px; }
        .chat-text { font-size: 14px; color: #e6edf3; }
        
        /* ç©ºçŠ¶æ€ */
        .empty { grid-column: span 2; text-align: center; padding: 60px 0; color: #6b7fa5; }
        
        /* åŠ¨ç”» */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translate(-50%, 20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .fade-out { animation: fadeOut 0.3s ease forwards; }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .main-container { flex-direction: column; }
            .owner-sidebar { width: 100%; display: none; margin-top: 20px; }
            .oc-grid { grid-template-columns: 1fr; }
            .chat-bubble-wrap { bottom: 20px; max-width: 90%; }
        }
    </style>
</head>
<body>
    <!-- éšæœºäº‹ä»¶æç¤ºæ¡ -->
    <div class="tip-bar" id="tipBar"></div>

    <div class="header">
        <div class="title">ğŸ¦ LionfishåŸ Â· OCå®æ—¶è¡Œè¸ª</div>
        <div class="real-clock" id="clock">åŠ è½½ç³»ç»Ÿæ—¶é—´â€¦</div>
        <div class="area-path" id="areaPath">åœ£åŸƒæ–¯ç‰¹ç½—åŒº > ä¹æœ¨é…’å±‹</div>
    </div>

    <!-- å¤§åŒºæŠ½å±‰ + å°åœ°ç‚¹ç½‘æ ¼ -->
    <div class="area-drawer-wrap" id="areaDrawerWrap"></div>

    <!-- ä¸»ä½“ï¼šOCå¡ç‰‡ + ä¸»äººæ  -->
    <div class="main-container">
        <div class="oc-container" id="ocContainer">
            <div class="empty">åŠ è½½ä¸­...</div>
        </div>
        <div class="owner-sidebar" id="ownerSidebar">
            <div class="owner-title">ğŸ“ åœ°ç‚¹ä¸»äºº</div>
            <div id="ownerContent"></div>
        </div>
    </div>

    <!-- èŠå¤©æ°”æ³¡å®¹å™¨ -->
    <div class="chat-bubble-wrap" id="chatBubbleWrap"></div>

    <script>
        // å…¨å±€å˜é‡
        let ocData = [];
        let areaData = [];
        let chatData = [];
        let randomData = [];
        let currentBigArea = "";
        let currentSmallArea = "";
        let chatTriggered = new Set(); // è®°å½•å·²è§¦å‘çš„å¯¹è¯ï¼Œé˜²æ­¢é‡å¤
        
        // 1. è§£ææ—¶é—´æ®µï¼Œåˆ¤æ–­å½“å‰æ—¶é—´æ˜¯å¦åœ¨èŒƒå›´å†…
        function isInTimeRange(currentTimeStr, timeRange) {
            const [start, end] = timeRange.split("-");
            const current = new Date(`2000-01-01 ${currentTimeStr}`);
            const startDate = new Date(`2000-01-01 ${start}`);
            const endDate = new Date(`2000-01-01 ${end}`);
            return current >= startDate && current < endDate;
        }

        // 2. è¯»å–åœ°ç‚¹ä¸“å±éšæœºaction
        function getLocationRandomAction(oc, area) {
            const actions = oc.locationRandomActions[area] || [];
            return actions.length > 0 ? getRandomText(actions) : "æš‚æ— çŠ¶æ€";
        }

        // 3. åŠ è½½æ‰€æœ‰JSONæ•°æ®åº“
        async function loadAllData() {
            try {
                const [ocRes, areaRes, chatRes, randomRes] = await Promise.all([
                    fetch('./ocData.json'),
                    fetch('./areaData.json'),
                    fetch('./chatData.json'),
                    fetch('./randomData.json')
                ]);
                
                ocData = await ocRes.json();
                areaData = await areaRes.json();
                randomData = await randomRes.json();
                chatData = await chatRes.json();
                
                // åˆå§‹åŒ–é¡µé¢
                initAreaDrawer();
                updateRealTime();
                renderOC();
                // æ¯ç§’æ›´æ–°ä¸€æ¬¡ï¼ˆç²¾å‡†åˆ°åˆ†é’Ÿï¼‰
                setInterval(updateRealTime, 1000);
            } catch (err) {
                console.error("åŠ è½½æ•°æ®å¤±è´¥ï¼š", err);
                document.getElementById("ocContainer").innerHTML = `<div class="empty">æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥JSONæ–‡ä»¶</div>`;
            }
        }

        // 4. åˆå§‹åŒ–å¤§åŒºæŠ½å±‰+å°åœ°ç‚¹ç½‘æ ¼
        function initAreaDrawer() {
            const areaDrawerWrap = document.getElementById("areaDrawerWrap");
            // æŒ‰å¤§åŒºåˆ†ç»„å°åœ°ç‚¹
            const bigAreaGroups = {};
            areaData.forEach(item => {
                if (!bigAreaGroups[item.bigArea]) {
                    bigAreaGroups[item.bigArea] = [];
                }
                bigAreaGroups[item.bigArea].push(item);
            });

            // æ¸²æŸ“å¤§åŒºæŠ½å±‰
            let drawerHtml = "";
            const bigAreas = Object.keys(bigAreaGroups);
            bigAreas.forEach((bigArea, index) => {
                const smallAreas = bigAreaGroups[bigArea];
                // é»˜è®¤å±•å¼€ç¬¬ä¸€ä¸ªå¤§åŒº
                const isActive = index === 0 ? "show" : "";
                const iconActive = index === 0 ? "active" : "";
                
                // æ¸²æŸ“å°åœ°ç‚¹ç½‘æ ¼
                let smallGridHtml = "";
                smallAreas.forEach(smallArea => {
                    const isImportant = smallArea.important ? "important" : "";
                    // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªå¤§åŒºçš„ç¬¬ä¸€ä¸ªå°åœ°ç‚¹
                    const isSmallActive = (index === 0 && smallAreas.indexOf(smallArea) === 0) ? "active" : "";
                    smallGridHtml += `
                        <div class="small-area-card ${isImportant} ${isSmallActive}" data-big="${bigArea}" data-small="${smallArea.smallArea}">
                            ${smallArea.smallArea}
                        </div>
                    `;
                });

                drawerHtml += `
                    <div class="big-area-drawer">
                        <div class="big-area-header" data-big="${bigArea}">
                            <div class="big-area-name">${bigArea}</div>
                            <div class="drawer-icon ${iconActive}">â–¼</div>
                        </div>
                        <div class="small-area-grid ${isActive}" id="smallGrid_${bigArea.replace(/\s/g, '')}">
                            ${smallGridHtml}
                        </div>
                    </div>
                `;
            });
            areaDrawerWrap.innerHTML = drawerHtml;

            // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªå¤§åŒºå’Œå°åœ°ç‚¹
            currentBigArea = bigAreas[0];
            currentSmallArea = bigAreaGroups[currentBigArea][0].smallArea;

            // å¤§åŒºæŠ½å±‰å±•å¼€/æ”¶èµ·äº‹ä»¶
            document.querySelectorAll(".big-area-header").forEach(header => {
                header.addEventListener("click", () => {
                    const bigArea = header.dataset.big;
                    const gridId = `smallGrid_${bigArea.replace(/\s/g, '')}`;
                    const grid = document.getElementById(gridId);
                    const icon = header.querySelector(".drawer-icon");
                    
                    grid.classList.toggle("show");
                    icon.classList.toggle("active");
                });
            });

            // å°åœ°ç‚¹ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll(".small-area-card").forEach(card => {
                card.addEventListener("click", () => {
                    // å–æ¶ˆæ‰€æœ‰å°åœ°ç‚¹é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll(".small-area-card").forEach(t => t.classList.remove("active"));
                    // é€‰ä¸­å½“å‰å°åœ°ç‚¹
                    card.classList.add("active");
                    // æ›´æ–°å½“å‰é€‰ä¸­çš„å¤§åŒº/å°åœ°ç‚¹
                    currentBigArea = card.dataset.big;
                    currentSmallArea = card.dataset.small;
                    // æ›´æ–°è·¯å¾„+æ¸²æŸ“OC+æ¸²æŸ“ä¸»äººæ 
                    updateAreaPath();
                    renderOC();
                    renderOwnerSidebar();
                });
            });
        }

        // 5. æ›´æ–°å½“å‰è·¯å¾„
        function updateAreaPath() {
            const pathEl = document.getElementById("areaPath");
            pathEl.innerText = `${currentBigArea} > ${currentSmallArea}`;
            pathEl.classList.remove("random");
        }

        // 6. è·å–å®æ—¶ç³»ç»Ÿæ—¶é—´
        function getRealTime() {
            const d = new Date();
            return {
                week: d.getDay(),       // 0=å‘¨æ—¥,1=å‘¨ä¸€...6=å‘¨å…­
                hour: d.getHours(),     // 0-23
                minute: d.getMinutes(), // 0-59
                timeStr: `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`,
                str: `${["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][d.getDay()]} ${d.getHours()}:${String(d.getMinutes()).padStart(2,'0')}`
            };
        }

        // 7. æ˜¾ç¤ºéšæœºäº‹ä»¶æç¤º
        function showRandomTip(text) {
            const tipBar = document.getElementById("tipBar");
            tipBar.innerText = text;
            tipBar.classList.add("show");
            setTimeout(() => {
                tipBar.classList.remove("show");
            }, 3000);
        }

        // 8. æ£€æŸ¥éšæœºäº‹ä»¶
        function checkRandomEvent(oc, now) {
            if (!oc.randomEvents || oc.randomEvents.length === 0) {
                // æ— éšæœºäº‹ä»¶ï¼ŒæŸ¥åŸºç¡€è¡Œç¨‹
                const baseSchedule = oc.baseSchedule.find(s => 
                    s.week.includes(now.week) && isInTimeRange(now.timeStr, s.timeRange)
                );
                return {
                    isRandom: false,
                    schedule: baseSchedule || null
                };
            }
            
            // æŸ¥å½“å‰æ—¶é—´çš„éšæœºäº‹ä»¶
            const randomEvent = oc.randomEvents.find(e => 
                e.week.includes(now.week) && isInTimeRange(now.timeStr, e.timeRange)
            );
            
            if (!randomEvent) {
                // æ— éšæœºäº‹ä»¶ï¼ŒæŸ¥åŸºç¡€è¡Œç¨‹
                const baseSchedule = oc.baseSchedule.find(s => 
                    s.week.includes(now.week) && isInTimeRange(now.timeStr, s.timeRange)
                );
                return {
                    isRandom: false,
                    schedule: baseSchedule || null
                };
            }
            
            // è®¡ç®—æ¦‚ç‡
            const randomNum = Math.floor(Math.random() * 101);
            if (randomNum <= randomEvent.probability) {
                // è§¦å‘éšæœºäº‹ä»¶
                showRandomTip(randomEvent.tip);
                return {
                    isRandom: true,
                    schedule: randomEvent
                };
            } else {
                // æœªè§¦å‘ï¼ŒæŸ¥åŸºç¡€è¡Œç¨‹
                const baseSchedule = oc.baseSchedule.find(s => 
                    s.week.includes(now.week) && isInTimeRange(now.timeStr, s.timeRange)
                );
                return {
                    isRandom: false,
                    schedule: baseSchedule || null
                };
            }
        }

        // 9. æ›´æ–°å®æ—¶æ—¶é—´æ˜¾ç¤º
        function updateRealTime() {
            const now = getRealTime();
            document.getElementById("clock").innerText = "å½“å‰ Â· " + now.str;
            renderOC();
        }

        // 10. è·å–éšæœºæ–‡æ¡ˆ
        function getRandomText(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // 11. æ¸²æŸ“OCå¡ç‰‡
        function renderOC() {
            const now = getRealTime();
            const ocContainer = document.getElementById("ocContainer");
            const pathEl = document.getElementById("areaPath");
            
            pathEl.classList.remove("random");
            
            // ç­›é€‰å½“å‰åœ°ç‚¹çš„OC
            const filteredOC = [];
            ocData.forEach(oc => {
                const { isRandom, schedule } = checkRandomEvent(oc, now);
                if (schedule && schedule.area === currentSmallArea) {
                    filteredOC.push({
                        oc: oc,
                        schedule: schedule,
                        isRandom: isRandom
                    });
                }
            });
            
            // æ¸²æŸ“OC
            if (filteredOC.length === 0) {
                ocContainer.innerHTML = `<div class="empty">æ­¤åˆ»è¿™é‡Œæ²¡æœ‰OC</div>`;
            } else {
                ocContainer.innerHTML = filteredOC.map(item => {
                    const oc = item.oc;
                    const schedule = item.schedule;
                    const isRandom = item.isRandom;
                    
                    // è¯»å–åœ°ç‚¹ä¸“å±éšæœºaction
                    const randomAction = getLocationRandomAction(oc, schedule.area);
                    
                    // éšæœºäº‹ä»¶æ ‡ç­¾
                    const randomTag = isRandom ? `<div class="oc-random-tag">âœ¨ éšæœºäº‹ä»¶</div>` : "";
                    
                    if (isRandom) pathEl.classList.add("random");
                    
                    return `
                        <div class="oc-card ${isRandom ? 'random' : ''}">
                            ${randomTag}
                            <div class="oc-row">
                                <img src="${oc.avatar}" class="oc-avatar" alt="${oc.name}">
                                <div class="oc-info">
                                    <div class="oc-name">${oc.name}</div>
                                    <div class="oc-place">ğŸ“ ${schedule.area}</div>
                                </div>
                            </div>
                            <div class="oc-action">${randomAction}</div>
                            <div class="oc-popup">
                                <div>ğŸ“… å½“å‰æ—¶æ®µï¼š${schedule.timeRange || 'å®æ—¶'}</div>
                                <div>â³ å®æ—¶çŠ¶æ€</div>
                                <div><a href="${oc.link}" target="_blank">ğŸ”— æŸ¥çœ‹ä¸ªäººä¸»é¡µ</a></div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // æ£€æŸ¥å¯¹è¯è§¦å‘
            const ocNames = filteredOC.map(item => item.oc.name);
            checkChatTrigger(ocNames, now);
        }

        // 12. æ¸²æŸ“åœ°ç‚¹ä¸»äººæ 
        function renderOwnerSidebar() {
            const ownerSidebar = document.getElementById("ownerSidebar");
            const ownerContent = document.getElementById("ownerContent");
            const now = getRealTime();
            
            const areaInfo = areaData.find(item => item.smallArea === currentSmallArea);
            if (!areaInfo || !areaInfo.owner || areaInfo.owner.length === 0) {
                ownerSidebar.style.display = "none";
                return;
            }
            
            ownerSidebar.style.display = "block";
            let ownerHtml = "";
            
            areaInfo.owner.forEach(ownerName => {
                const ownerOC = ocData.find(oc => oc.name === ownerName);
                if (!ownerOC) return;
                
                const { isRandom, schedule } = checkRandomEvent(ownerOC, now);
                let status = "æš‚æ— çŠ¶æ€";
                
                if (schedule) {
                    status = isRandom ? 
                        `âœ… éšæœºäº‹ä»¶ï¼š${schedule.action}` : 
                        `âœ… æ­£åœ¨æ­¤å¤„ï¼š${getLocationRandomAction(ownerOC, schedule.area)}`;
                } else {
                    const charAbsentText = randomData.absentText[ownerName] || randomData.absentText.default;
                    status = `ğŸ”´ æš‚æ—¶ç¦»å¼€ï¼š${getRandomText(charAbsentText)}`;
                }
                
                ownerHtml += `
                    <div class="owner-card">
                        <img src="${ownerOC.avatar}" class="owner-avatar" alt="${ownerName}">
                        <div class="owner-info">
                            <div class="owner-name">${ownerName}</div>
                            <div class="owner-status">${status}</div>
                        </div>
                    </div>
                `;
            });
            
            ownerContent.innerHTML = ownerHtml || `<div class="empty">æš‚æ— ä¸»äººä¿¡æ¯</div>`;
        }

        // 13. æ£€æŸ¥å¯¹è¯è§¦å‘
        function checkChatTrigger(ocNames, now) {
            const chatWrap = document.getElementById("chatBubbleWrap");
            const areaChats = chatData.filter(chat => chat.area === currentSmallArea);
            
            areaChats.forEach(chat => {
                if (chatTriggered.has(chat.id)) return;
                
                const allPresent = chat.characters.every(char => 
                    ocNames.includes(char)
                );
                
                if (allPresent) {
                    chatTriggered.add(chat.id);
                    const randomChat = getRandomText(chat.dialogues);
                    renderChatBubble(randomChat, chat.characters);
                }
            });
        }

        // 14. æ¸²æŸ“èŠå¤©æ°”æ³¡
        function renderChatBubble(dialogue, characters) {
            const chatWrap = document.getElementById("chatBubbleWrap");
            chatWrap.innerHTML = "";
            
            dialogue.forEach((msg, index) => {
                const charOC = ocData.find(oc => oc.name === msg.character);
                if (!charOC) return;
                
                const bubble = document.createElement("div");
                bubble.className = "chat-bubble";
                bubble.style.animationDelay = `${index * 0.3}s`;
                bubble.innerHTML = `
                    <img src="${charOC.avatar}" class="chat-avatar" alt="${msg.character}">
                    <div class="chat-content">
                        <div class="chat-name">${msg.character}</div>
                        <div class="chat-text">${msg.text}</div>
                    </div>
                `;
                chatWrap.appendChild(bubble);
                
                if (index === dialogue.length - 1) {
                    setTimeout(() => {
                        document.querySelectorAll(".chat-bubble").forEach((b, i) => {
                            setTimeout(() => {
                                b.classList.add("fade-out");
                                if (i === dialogue.length - 1) {
                                    setTimeout(() => chatWrap.innerHTML = "", 300);
                                }
                            }, i * 200);
                        });
                    }, 5000);
                }
            });
        }

        // åˆå§‹åŒ–
        loadAllData();
    </script>
</body>
</html>
